{% extends 'base.html' %}
{% load static %}
{% load colaborador_tags %}
{% load crispy_forms_tags %}

<title>{% block title %}{% if object.id %}Editar{% else %}Crear{% endif %} Post | Smart Cities{% endblock %}</title>

{% block contenido %}


{% if user.is_superuser or request.user|has_group:"Colaborador" %}
<div class="container py-5 mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-9">
            
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold text-dark">
                    {% if object.id %} Modificar{% else %} Crear {% endif %} Post
                </h2>
                
                <a class="btn btn-success" href="{% url 'apps.posts:crear_categoria' %}{% if object.id %}?next={{ request.get_full_path }}{% endif %}">
                    <i class="fas fa-plus-circle"></i> Nueva Categoría
                </a>
            </div>

            <div class="card card-post bg-white">
                <div class="card-body p-4 p-md-5">
                    <form method="POST" enctype="multipart/form-data" id="posts-form">
                        {% csrf_token %}
                        
                        {# Aquí Crispy hace toda la magia #}
                        {{ form|crispy }}

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                            <a href="{% url 'apps.posts:posts' %}" class="btn btn-light border px-4">Cancelar</a>
                            <button type="submit" class="btn btn-primary px-5">
                                {% if object.id %}Actualizar post{% else %}Publicar Ahora{% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>

{% else %}
    <div class="container py-5 mt-5 text-center">
        <div class="alert alert-warning shadow p-5" role="alert">
            <i class="fas fa-lock fa-3x mb-3 text-danger"></i>
            <h2 class="fw-bold">Acceso Restringido</h2>
            <p class="lead">Lo sentimos, no tenés los permisos necesarios para gestionar artículos.</p>
            <a href="{% url 'index' %}" class="btn btn-dark mt-3">Volver al Inicio</a>
        </div>
    </div>
{% endif %}
{% endblock contenido %}